<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>企业实名认证 - 重要成员</title>
    <link rel="stylesheet" href="../../styles/main.css">
    <link rel="stylesheet" href="../../styles/header.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #7D33FF;
            --primary-hover: #6929D4;
            --primary-light: rgba(125, 51, 255, 0.1);
            --bg-color: #FFFFFF;
            --text-primary: #1F1F1F;
            --text-secondary: #666666;
            --border-color: #E5E5E5;
            --success-color: #34C759;
            --card-shadow: 0 2px 8px rgba(125, 51, 255, 0.08);
            --transition: all 0.2s ease-in-out;
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 12px;
            --spacing-lg: 16px;
            --spacing-xl: 24px;
            --radius-sm: 4px;
            --radius-md: 6px;
            --radius-lg: 8px;
            --header-height: 56px;
            --form-row-gap: 12px;
            --form-group-margin: 8px;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            color: var(--text-primary);
            line-height: 1.5;
            background-color: #F8F7FF;
            margin: 0;
            padding: 0;
            padding-top: var(--header-height);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .content {
            padding: var(--spacing-xl);
        }

        .verification-container {
            display: flex;
            gap: var(--spacing-xl);
            max-width: 1200px;
            margin: 0 auto;
        }

        .progress-steps {
            width: 240px;
            min-width: 240px;
            background-color: #fff;
            border-radius: 12px;
            padding: 24px;
            box-shadow: var(--card-shadow);
            position: sticky;
            top: calc(var(--header-height) + 24px);
            align-self: flex-start;
            height: fit-content;
        }

        .step {
            display: flex;
            margin-bottom: 24px;
            position: relative;
            padding-left: 40px;
        }

        .step:last-child {
            margin-bottom: 0;
        }

        .step::before {
            content: "";
            position: absolute;
            left: 14px;
            top: 24px;
            bottom: -24px;
            width: 2px;
            background-color: var(--border-color);
            transition: var(--transition);
        }

        .step:last-child::before {
            display: none;
        }

        .step.active::before {
            background-color: var(--primary-color);
        }

        .step.completed::before {
            background-color: var(--primary-color);
        }

        .step-number {
            position: absolute;
            left: 0;
            top: 0;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background-color: var(--bg-color);
            border: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            z-index: 1;
            transition: var(--transition);
        }

        .step.active .step-number {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        .step.completed .step-number {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 4px;
            transition: var(--transition);
        }

        .step.active .step-title {
            color: var(--primary-color);
            font-weight: 600;
        }

        .step.completed .step-title {
            color: var(--primary-color);
        }

        .step-desc {
            font-size: 12px;
            color: var(--text-secondary);
            opacity: 0.8;
            transition: var(--transition);
        }

        .form-container {
            flex: 1;
            background: var(--bg-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-xl);
            box-shadow: var(--card-shadow);
        }

        .form-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: var(--spacing-xl);
            padding-bottom: var(--spacing-lg);
            border-bottom: 1px solid var(--border-color);
        }

        .member-card {
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-xl);
        }

        .member-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
        }

        .member-card-title {
            font-weight: 600;
            font-size: 16px;
        }

        .member-card-action {
            color: #FF4D4F;
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
            padding: 6px 12px;
            border-radius: var(--radius-sm);
            background: rgba(255, 77, 79, 0.1);
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .member-card-action:hover {
            background: rgba(255, 77, 79, 0.2);
            color: #FF4D4F;
        }

        .member-card-action i {
            font-size: 14px;
        }

        .form-group {
            margin-bottom: var(--spacing-xl);
        }

        .form-label {
            display: block;
            font-weight: 500;
            font-size: 14px;
            margin-bottom: var(--spacing-sm);
        }

        .form-label.required::after {
            content: '*';
            color: #FF4D4F;
            margin-left: 4px;
        }

        .form-input,
        .form-select {
            width: 100%;
            height: 36px;
            padding: 0 var(--spacing-md);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: 14px;
            color: var(--text-primary);
            transition: var(--transition);
            background-color: var(--bg-color);
            box-sizing: border-box;
        }

        .form-input[type="date"] {
            padding-right: var(--spacing-sm);
        }

        .form-input[type="number"] {
            -webkit-appearance: textfield;
            -moz-appearance: textfield;
            appearance: textfield;
        }

        .form-input[type="number"]::-webkit-outer-spin-button,
        .form-input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            appearance: none;
            margin: 0;
        }

        .form-input:disabled,
        .form-select:disabled {
            background-color: #F5F5F5;
            cursor: not-allowed;
        }

        .form-input:focus,
        .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px var(--primary-light);
            outline: none;
        }

        .form-input::placeholder {
            color: var(--text-secondary);
        }

        .form-row {
            display: flex;
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
            align-items: flex-start;
        }

        .form-col {
            flex: 1;
            min-width: 0;
        }

        .form-col-auto {
            flex: 0 0 auto;
        }

        .upload-area {
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background: #FAFAFA;
            position: relative;
            overflow: hidden;
            height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-bottom: 4px;
        }

        .upload-area.dragover {
            border-color: var(--primary-color);
            background-color: var(--primary-light);
        }

        .upload-area.dragover i,
        .upload-area.dragover p {
            color: var(--primary-color);
        }

        .upload-area i {
            font-size: 24px;
            color: var(--primary-color);
            margin-bottom: var(--spacing-sm);
        }

        .upload-area p {
            margin: 4px 0;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .example-link {
            color: var(--primary-color);
            font-size: 13px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .example-link:hover {
            text-decoration: underline;
        }

        .example-link i {
            font-size: 14px;
        }

        .checkbox-list {
            display: flex;
            flex-wrap: wrap;
            gap: 32px;
            margin-top: 0;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            user-select: none;
            white-space: nowrap;
        }

        .checkbox-item input[type="radio"] {
            width: 16px;
            height: 16px;
            accent-color: var(--primary-color);
            margin: 0;
        }

        .checkbox-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: var(--primary-color);
            margin: 0;
        }

        .checkbox-item span {
            font-size: 14px;
            color: var(--text-primary);
        }

        .add-member-btn {
            width: 100%;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 24px;
            background-color: rgba(125, 51, 255, 0.04);
            color: var(--primary-color);
            border: 1px dashed var(--primary-color);
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 0 16px;
        }

        .add-member-btn:hover {
            background-color: rgba(125, 51, 255, 0.08);
        }

        .add-member-btn i {
            font-size: 14px;
            color: var(--primary-color);
        }

        .add-member-btn span {
            color: var(--primary-color);
        }

        .form-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 24px;
            border-top: 1px solid var(--border-color);
            margin-top: 24px;
        }

        .form-actions-left,
        .form-actions-right {
            display: flex;
            gap: 16px;
        }

        .btn {
            height: 40px;
            padding: 0 24px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            border: none;
            outline: none;
        }

        .btn i {
            margin-right: 8px;
            font-size: 14px;
        }

        .btn-primary {
            background-color: #7D33FF !important;
            color: white !important;
            border: none !important;
        }

        .btn-primary:hover {
            background-color: #6929D4 !important;
        }

        .btn-secondary {
            background-color: rgba(125, 51, 255, 0.1) !important;
            color: #7D33FF !important;
            border: 1px solid #E5E5E5 !important;
        }

        .btn-secondary:hover {
            background-color: rgba(125, 51, 255, 0.2) !important;
        }

        .form-note {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: var(--spacing-xs);
        }

        .form-hint {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: var(--spacing-xs);
        }

        .form-input-group {
            position: relative;
            max-width: 200px;
        }

        .form-input-group .form-input {
            padding-right: 32px;
        }

        .form-input-suffix {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            font-size: 14px;
            pointer-events: none;
        }

        .form-note.info {
            display: flex;
            align-items: center;
            gap: 4px;
            background-color: rgba(125, 51, 255, 0.1);
            color: var(--text-secondary);
            padding: 8px 12px;
            border-radius: var(--radius-sm);
            margin-top: 8px;
        }

        .form-note.info i {
            color: var(--primary-color);
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-logo">
            <img src="../../assets/images/whaletlogo2.png" alt="Whalet Logo">
        </div>
        <div class="header-divider"></div>
        <span class="header-title">大陆企业实名认证</span>
        <i class="fas fa-times header-close" onclick="closeHeader()"></i>
    </div>

    <div class="content">
        <div class="verification-container">
            <div class="progress-steps">
                <div class="step active">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <div class="step-title">企业信息</div>
                        <div class="step-desc">填写企业基本信息</div>
                    </div>
                </div>
                <div class="step active">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <div class="step-title">重要成员</div>
                        <div class="step-desc">填写重要成员信息</div>
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <div class="step-title">开户授权</div>
                        <div class="step-desc">上传开户授权资料</div>
                    </div>
                </div>
                <div class="step">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <div class="step-title">完成</div>
                        <div class="step-desc">提交成功，等待审核</div>
                    </div>
                </div>
            </div>

            <div class="form-container">
                <h2 class="form-title">重要成员信息</h2>

                <!-- 成员信息卡片 -->
                <div class="member-card" data-member-id="1">
                    <div class="member-card-header">
                        <div class="member-card-title">成员 1</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">证件类型</label>
                        <select class="form-select" disabled>
                            <option value="mainland_id" selected>中国大陆第二代身份证</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">身份证照片</label>
                        <div class="form-row">
                            <div class="form-col">
                                <div class="upload-area" onclick="triggerFileInput('id-front-1')">
                                    <i class="fas fa-id-card"></i>
                                    <p>点击或拖拽上传身份证人像面</p>
                                    <p>支持 JPG、JPEG、PNG、BMP 格式，不超过 5MB</p>
                                </div>
                                <input type="file" id="id-front-1" style="display: none" accept=".jpg,.jpeg,.png" onchange="handleFileUpload(this, 1)">
                                <a href="#" class="example-link" onclick="showExample('身份证人像面')">
                                    <i class="fas fa-image"></i>
                                    查看示例
                                </a>
                            </div>
                            <div class="form-col">
                                <div class="upload-area" onclick="triggerFileInput('id-back-1')">
                                    <i class="fas fa-id-card"></i>
                                    <p>点击或拖拽上传身份证国徽面</p>
                                    <p>支持 JPG、JPEG、PNG、BMP 格式，不超过 5MB</p>
                                </div>
                                <input type="file" id="id-back-1" style="display: none" accept=".jpg,.jpeg,.png" onchange="handleFileUpload(this, 1)">
                                <a href="#" class="example-link" onclick="showExample('身份证国徽面')">
                                    <i class="fas fa-image"></i>
                                    查看示例
                                </a>
                            </div>
                        </div>
                        <div id="upload-note-1" class="form-note info" style="display: none;">
                            <i class="fas fa-info-circle"></i>
                            上传证件照后自动识别信息，如有错误请调整修改
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label required">真实姓名</label>
                                <div style="display: flex; gap: 12px;">
                                    <input type="text" class="form-input" placeholder="姓氏" onchange="updatePinyin(1)">
                                    <input type="text" class="form-input" placeholder="名字" onchange="updatePinyin(1)">
                                </div>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label required">英文名称</label>
                                <input type="text" class="form-input" id="english-name-1">
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label required">成员身份</label>
                                <div class="checkbox-list">
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="member-role-1" value="controller">
                                        <span>实际控制人</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="member-role-1" value="legal">
                                        <span>法定代表人</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="member-role-1" value="director">
                                        <span>董事/股东</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label required">持股比例</label>
                                <div class="form-input-group">
                                    <input type="number" 
                                           class="form-input" 
                                           placeholder="请输入持股比例" 
                                           min="0" 
                                           max="100" 
                                           step="0.01"
                                           oninput="validateShareholding(this)"
                                           style="text-align: left; padding-right: 32px;">
                                    <span class="form-input-suffix">%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">身份证号码</label>
                        <input type="text" class="form-input" placeholder="请输入18位身份证号码">
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label required">性别</label>
                                <select class="form-select">
                                    <option value="" disabled selected>请选择性别</option>
                                    <option value="male">男</option>
                                    <option value="female">女</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label required">出生日期</label>
                                <input type="date" class="form-input">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">身份证地址</label>
                        <div class="form-row" style="margin-bottom: 8px;">
                            <div class="form-col">
                                <select class="form-select" id="province-1">
                                    <option value="" disabled selected>请选择省份</option>
                                </select>
                            </div>
                            <div class="form-col">
                                <select class="form-select" id="city-1">
                                    <option value="" disabled selected>请选择城市</option>
                                </select>
                            </div>
                            <div class="form-col">
                                <select class="form-select" id="district-1">
                                    <option value="" disabled selected>请选择区县</option>
                                </select>
                            </div>
                        </div>
                        <input type="text" class="form-input" placeholder="请输入详细地址">
                    </div>

                    <div class="form-group">
                        <label class="form-label required">居住地址</label>
                        <div class="checkbox-list">
                            <label class="checkbox-item">
                                <input type="radio" name="address-type-1" value="same" checked onchange="toggleAddress(1, 'same')">
                                <span>与证件地址相同</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="radio" name="address-type-1" value="different" onchange="toggleAddress(1, 'different')">
                                <span>与证件地址不同</span>
                            </label>
                        </div>
                        <div id="different-address-1" style="display: none; margin-top: 16px;">
                            <div class="form-row" style="margin-bottom: 8px;">
                                <div class="form-col">
                                    <select class="form-select">
                                        <option value="" disabled selected>请选择省份</option>
                                    </select>
                                </div>
                                <div class="form-col">
                                    <select class="form-select">
                                        <option value="" disabled selected>请选择城市</option>
                                    </select>
                                </div>
                                <div class="form-col">
                                    <select class="form-select">
                                        <option value="" disabled selected>请选择区县</option>
                                    </select>
                                </div>
                            </div>
                            <input type="text" class="form-input" placeholder="请输入详细地址">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">身份证有效期</label>
                        <div style="display: flex; align-items: center; gap: 16px;">
                            <div style="flex: 1; min-width: 0;">
                                <input type="date" class="form-input" placeholder="开始日期">
                            </div>
                            <div style="margin: 0 4px;">至</div>
                            <div style="flex: 1; min-width: 0;">
                                <input type="date" class="form-input" id="end-date-1" placeholder="结束日期">
                            </div>
                            <div style="flex: 0 0 auto;">
                                <label class="checkbox-item" style="margin: 0;">
                                    <input type="checkbox" onchange="toggleEndDate(1)">
                                    <span>长期</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 添加成员按钮 -->
                <div style="text-align: center;">
                    <button type="button" class="btn add-member-btn" onclick="addNewMember()">
                        <i class="fas fa-plus"></i>
                        <span>添加一个实际控制人/企业董事/股东(占股25%及以上)</span>
                    </button>
                </div>

                <!-- 操作按钮 -->
                <div class="form-actions" style="display: flex; justify-content: space-between; align-items: center; padding-top: 24px; border-top: 1px solid #E5E5E5; margin-top: 24px;">
                    <div class="form-actions-left" style="display: flex; gap: 16px;">
                        <button type="button" class="btn btn-secondary" onclick="prevStep()" style="height: 40px; padding: 0 24px; border-radius: 6px; font-size: 14px; font-weight: 500; display: inline-flex; align-items: center; justify-content: center; cursor: pointer; background-color: #7D33FF; color: white; border: none;">
                            <i class="fas fa-arrow-left" style="margin-right: 8px; font-size: 14px;"></i>
                            上一步
                        </button>
                    </div>
                    <div class="form-actions-right" style="display: flex; gap: 16px;">
                        <button type="button" class="btn btn-secondary" onclick="saveDraft()" style="height: 40px; padding: 0 24px; border-radius: 6px; font-size: 14px; font-weight: 500; display: inline-flex; align-items: center; justify-content: center; cursor: pointer; background-color: #7D33FF; color: white; border: none;">
                            <i class="fas fa-save" style="margin-right: 8px; font-size: 14px;"></i>
                            暂存
                        </button>
                        <button type="button" class="btn btn-primary" onclick="nextStep()" style="height: 40px; padding: 0 24px; border-radius: 6px; font-size: 14px; font-weight: 500; display: inline-flex; align-items: center; justify-content: center; cursor: pointer; background-color: #7D33FF; color: white; border: none;">
                            <i class="fas fa-arrow-right" style="margin-right: 8px; font-size: 14px;"></i>
                            下一步
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 省市区数据
        const addressData = {
            provinces: ['北京市', '上海市', '广东省', /* ... */],
            cities: {
                '广东省': ['广州市', '深圳市', '珠海市', /* ... */],
                // ...
            },
            districts: {
                '广州市': ['天河区', '海珠区', '越秀区', /* ... */],
                // ...
            }
        };

        // 初始化省市区选择器
        function initAddressSelectors(memberId) {
            const provinceSelect = document.getElementById(`province-${memberId}`);
            const citySelect = document.getElementById(`city-${memberId}`);
            const districtSelect = document.getElementById(`district-${memberId}`);

            // 添加省份选项
            addressData.provinces.forEach(province => {
                const option = document.createElement('option');
                option.value = province;
                option.textContent = province;
                provinceSelect.appendChild(option);
            });

            // 省份变化时更新城市
            provinceSelect.addEventListener('change', function() {
                const cities = addressData.cities[this.value] || [];
                citySelect.innerHTML = '<option value="" disabled selected>请选择城市</option>';
                cities.forEach(city => {
                    const option = document.createElement('option');
                    option.value = city;
                    option.textContent = city;
                    citySelect.appendChild(option);
                });
                districtSelect.innerHTML = '<option value="" disabled selected>请选择区县</option>';
            });

            // 城市变化时更新区县
            citySelect.addEventListener('change', function() {
                const districts = addressData.districts[this.value] || [];
                districtSelect.innerHTML = '<option value="" disabled selected>请选择区县</option>';
                districts.forEach(district => {
                    const option = document.createElement('option');
                    option.value = district;
                    option.textContent = district;
                    districtSelect.appendChild(option);
                });
            });
        }

        // 切换居住地址显示
        function toggleAddress(memberId, type) {
            const differentAddress = document.getElementById(`different-address-${memberId}`);
            differentAddress.style.display = type === 'different' ? 'block' : 'none';
        }

        // 切换身份证有效期结束日期
        function toggleEndDate(memberId) {
            const endDateInput = document.getElementById(`end-date-${memberId}`);
            endDateInput.disabled = !endDateInput.disabled;
            if (endDateInput.disabled) {
                endDateInput.value = '';
            }
        }

        // 更新拼音
        function updatePinyin(memberId) {
            const surnameInput = document.querySelector(`[data-member-id="${memberId}"] input[placeholder="姓氏"]`);
            const givenNameInput = document.querySelector(`[data-member-id="${memberId}"] input[placeholder="名字"]`);
            const englishNameInput = document.getElementById(`english-name-${memberId}`);
            
            if (surnameInput && givenNameInput && englishNameInput) {
                const surname = surnameInput.value;
                const givenName = givenNameInput.value;
                
                // 这里需要集成拼音转换库
                // 示例实现：将姓名转换为拼音（实际项目中需要使用真实的拼音转换库）
                const pinyinName = `${surname} ${givenName}`.toUpperCase();
                
                // 只有当英文名称为空或者与上一次生成的拼音相同时才自动更新
                if (!englishNameInput.value || englishNameInput.value === englishNameInput.dataset.lastPinyin) {
                    englishNameInput.value = pinyinName;
                    englishNameInput.dataset.lastPinyin = pinyinName;
                }
            }
        }

        // 显示示例图片
        function showExample(type) {
            alert(`这里将显示${type}的示例图片`);
        }

        // 触发文件上传
        function triggerFileInput(inputId) {
            document.getElementById(inputId).click();
        }

        // 删除成员
        function deleteMember(memberId) {
            if (confirm('确定要删除该成员吗？')) {
                const memberCard = document.querySelector(`[data-member-id="${memberId}"]`);
                if (memberCard) {
                    memberCard.remove();
                    // 重新排序剩余成员的编号
                    const remainingCards = document.querySelectorAll('.member-card');
                    remainingCards.forEach((card, index) => {
                        const newId = index + 1;
                        card.setAttribute('data-member-id', newId);
                        card.querySelector('.member-card-title').textContent = `成员 ${newId}`;
                    });
                }
            }
        }

        // 处理文件上传
        function handleFileUpload(input, memberId, file = null) {
            const uploadFile = file || (input.files && input.files[0]);
            if (uploadFile) {
                // 验证文件类型
                if (!uploadFile.type.match('image/jpeg') && !uploadFile.type.match('image/png')) {
                    alert('请上传 JPG 或 PNG 格式的图片');
                    return;
                }

                // 验证文件大小（5MB）
                if (uploadFile.size > 5 * 1024 * 1024) {
                    alert('文件大小不能超过 5MB');
                    return;
                }

                // 显示提示信息
                document.getElementById(`upload-note-${memberId}`).style.display = 'block';
                
                // 获取上传区域（如果是拖拽上传，需要从父元素找到对应的上传区域）
                const uploadArea = input.previousElementSibling || input.closest('.upload-area');
                
                // 创建预览
                const reader = new FileReader();
                reader.onload = function(e) {
                    uploadArea.innerHTML = `
                        <img src="${e.target.result}" style="max-width: 100%; max-height: 100px; object-fit: contain;">
                        <p style="margin-top: 8px;">点击或拖拽重新上传</p>
                    `;
                };
                reader.readAsDataURL(uploadFile);
            }
        }

        // 初始化拖拽上传
        function initDragAndDrop(memberId) {
            const uploadAreas = document.querySelectorAll(`[data-member-id="${memberId}"] .upload-area`);
            const fileInputs = document.querySelectorAll(`[data-member-id="${memberId}"] input[type="file"]`);

            uploadAreas.forEach((area, index) => {
                area.addEventListener('dragenter', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    area.classList.add('dragover');
                });

                area.addEventListener('dragleave', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    area.classList.remove('dragover');
                });

                area.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                });

                area.addEventListener('drop', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    area.classList.remove('dragover');

                    const file = e.dataTransfer.files[0];
                    if (file) {
                        handleFileUpload(fileInputs[index], memberId, file);
                    }
                });
            });
        }

        // 添加成员
        function addNewMember() {
            const memberCards = document.querySelectorAll('.member-card');
            const newMemberId = memberCards.length + 1;
            
            const memberTemplate = `
                <div class="member-card" data-member-id="${newMemberId}">
                    <div class="member-card-header">
                        <div class="member-card-title">成员 ${newMemberId}</div>
                        <div class="member-card-actions">
                            <span class="member-card-action" onclick="deleteMember(${newMemberId})">
                                <i class="fas fa-trash-alt"></i>
                                删除成员
                            </span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">证件类型</label>
                        <select class="form-select" disabled>
                            <option value="mainland_id" selected>中国大陆第二代身份证</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">身份证照片</label>
                        <div class="form-row">
                            <div class="form-col">
                                <div class="upload-area" onclick="triggerFileInput('id-front-${newMemberId}')">
                                    <i class="fas fa-id-card"></i>
                                    <p>点击或拖拽上传身份证人像面</p>
                                    <p>支持 JPG、JPEG、PNG、BMP 格式，不超过 5MB</p>
                                </div>
                                <input type="file" id="id-front-${newMemberId}" style="display: none" accept=".jpg,.jpeg,.png" onchange="handleFileUpload(this, ${newMemberId})">
                                <a href="#" class="example-link" onclick="showExample('身份证人像面')">
                                    <i class="fas fa-image"></i>
                                    查看示例
                                </a>
                            </div>
                            <div class="form-col">
                                <div class="upload-area" onclick="triggerFileInput('id-back-${newMemberId}')">
                                    <i class="fas fa-id-card"></i>
                                    <p>点击或拖拽上传身份证国徽面</p>
                                    <p>支持 JPG、JPEG、PNG、BMP 格式，不超过 5MB</p>
                                </div>
                                <input type="file" id="id-back-${newMemberId}" style="display: none" accept=".jpg,.jpeg,.png" onchange="handleFileUpload(this, ${newMemberId})">
                                <a href="#" class="example-link" onclick="showExample('身份证国徽面')">
                                    <i class="fas fa-image"></i>
                                    查看示例
                                </a>
                            </div>
                        </div>
                        <div id="upload-note-${newMemberId}" class="form-note info" style="display: none;">
                            <i class="fas fa-info-circle"></i>
                            上传证件照后自动识别信息，如有错误请调整修改
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label required">真实姓名</label>
                                <div style="display: flex; gap: 12px;">
                                    <input type="text" class="form-input" placeholder="姓氏" onchange="updatePinyin(${newMemberId})">
                                    <input type="text" class="form-input" placeholder="名字" onchange="updatePinyin(${newMemberId})">
                                </div>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label required">英文名称</label>
                                <input type="text" class="form-input" id="english-name-${newMemberId}">
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label required">成员身份</label>
                                <div class="checkbox-list">
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="member-role-${newMemberId}" value="controller">
                                        <span>实际控制人</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="member-role-${newMemberId}" value="legal">
                                        <span>法定代表人</span>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" name="member-role-${newMemberId}" value="director">
                                        <span>董事/股东</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label required">持股比例</label>
                                <div class="form-input-group">
                                    <input type="number" 
                                           class="form-input" 
                                           placeholder="请输入持股比例" 
                                           min="0" 
                                           max="100" 
                                           step="0.01"
                                           oninput="validateShareholding(this)"
                                           style="text-align: left; padding-right: 32px;">
                                    <span class="form-input-suffix">%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">身份证号码</label>
                        <input type="text" class="form-input" placeholder="请输入18位身份证号码">
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label required">性别</label>
                                <select class="form-select">
                                    <option value="" disabled selected>请选择性别</option>
                                    <option value="male">男</option>
                                    <option value="female">女</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label required">出生日期</label>
                                <input type="date" class="form-input">
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">身份证地址</label>
                        <div class="form-row" style="margin-bottom: 8px;">
                            <div class="form-col">
                                <select class="form-select" id="province-${newMemberId}">
                                    <option value="" disabled selected>请选择省份</option>
                                </select>
                            </div>
                            <div class="form-col">
                                <select class="form-select" id="city-${newMemberId}">
                                    <option value="" disabled selected>请选择城市</option>
                                </select>
                            </div>
                            <div class="form-col">
                                <select class="form-select" id="district-${newMemberId}">
                                    <option value="" disabled selected>请选择区县</option>
                                </select>
                            </div>
                        </div>
                        <input type="text" class="form-input" placeholder="请输入详细地址">
                    </div>

                    <div class="form-group">
                        <label class="form-label required">居住地址</label>
                        <div class="checkbox-list">
                            <label class="checkbox-item">
                                <input type="radio" name="address-type-${newMemberId}" value="same" checked onchange="toggleAddress(${newMemberId}, 'same')">
                                <span>与证件地址相同</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="radio" name="address-type-${newMemberId}" value="different" onchange="toggleAddress(${newMemberId}, 'different')">
                                <span>与证件地址不同</span>
                            </label>
                        </div>
                        <div id="different-address-${newMemberId}" style="display: none; margin-top: 16px;">
                            <div class="form-row" style="margin-bottom: 8px;">
                                <div class="form-col">
                                    <select class="form-select">
                                        <option value="" disabled selected>请选择省份</option>
                                    </select>
                                </div>
                                <div class="form-col">
                                    <select class="form-select">
                                        <option value="" disabled selected>请选择城市</option>
                                    </select>
                                </div>
                                <div class="form-col">
                                    <select class="form-select">
                                        <option value="" disabled selected>请选择区县</option>
                                    </select>
                                </div>
                            </div>
                            <input type="text" class="form-input" placeholder="请输入详细地址">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">身份证有效期</label>
                        <div style="display: flex; align-items: center; gap: 16px;">
                            <div style="flex: 1; min-width: 0;">
                                <input type="date" class="form-input" placeholder="开始日期">
                            </div>
                            <div style="margin: 0 4px;">至</div>
                            <div style="flex: 1; min-width: 0;">
                                <input type="date" class="form-input" id="end-date-${newMemberId}" placeholder="结束日期">
                            </div>
                            <div style="flex: 0 0 auto;">
                                <label class="checkbox-item" style="margin: 0;">
                                    <input type="checkbox" onchange="toggleEndDate(${newMemberId})">
                                    <span>长期</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // 在添加成员按钮前插入新成员卡片
            const addMemberBtn = document.querySelector('.add-member-btn');
            addMemberBtn.insertAdjacentHTML('beforebegin', memberTemplate);

            // 初始化新成员的地址选择器和拖拽上传
            initAddressSelectors(newMemberId);
            initDragAndDrop(newMemberId);
        }

        // 上一步
        function prevStep() {
            window.location.href = './mainland-business-verification.html';
        }

        // 下一步
        function nextStep() {
            window.location.href = './mainland-business-verification-step3.html';
        }

        // 暂存
        function saveDraft() {
            alert('已暂存当前填写内容');
        }

        // 返回
        function goBack() {
            window.location.href = './mainland-business-verification.html';
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            initAddressSelectors(1);
            initDragAndDrop(1);
        });
    </script>
</body>
</html> 
